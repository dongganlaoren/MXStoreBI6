{# 用户编辑页模板 #}
{% extends 'base.html' %}
{% block title %}编辑用户{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>编辑用户</h2>
    <form method="post" id="user-edit-form">
        {{ form.hidden_tag() }}
        <div class="mb-3">
            <label class="form-label">用户名</label>
            <input class="form-control" value="{{ user.username }}" readonly>
        </div>
        <div class="mb-3">
            <label class="form-label">角色</label>
            {{ form.role(class="form-select", id="role-select") if form.role else '' }}
        </div>
        <div class="mb-3" id="store-group">
            <label class="form-label">所属门店</label>
            {{ form.store_id(class="form-select", id="store-select") if form.store_id else '' }}
        </div>
        <div class="mb-3">
            <label class="form-label">真实姓名</label>
            {{ form.real_name(class="form-control") }}
        </div>
        <div class="mb-3">
            <label class="form-label">身份证号</label>
            {{ form.id_card_number(class="form-control") }}
        </div>
        <div class="mb-3">
            <label class="form-label">银行名称</label>
            {{ form.bank_name(class="form-control") }}
        </div>
        <div class="mb-3">
            <label class="form-label">银行账号</label>
            {{ form.bank_account_number(class="form-control") }}
        </div>
        <div class="mb-3">
            <label class="form-label">联系电话</label>
            {{ form.phone(class="form-control") }}
        </div>
        <div class="mb-3">
            <label class="form-label">LINE ID</label>
            {{ form.line_id(class="form-control") }}
        </div>
        <div class="mb-3">
            <label class="form-label">电子邮箱</label>
            {{ form.email(class="form-control") }}
        </div>
        <div class="mb-3">
            <label class="form-label">入职日期</label>
            {{ form.start_date(class="form-control") }}
        </div>
        <div class="mb-3">
            <label class="form-label">是否为主要联系人</label>
            {{ form.is_primary_contact() }}
        </div>
        <button type="submit" class="btn btn-primary">保存</button>
        <a href="{{ url_for('admin_user.user_detail', user_id=user.user_id) }}" class="btn btn-secondary">取消</a>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
    function toggleStoreField() {
        const role = document.getElementById('role-select').value;
        const adminRoleValues = ['admin', 'head_manager', 'finance'];
        const storeGroup = document.getElementById('store-group');
        if (adminRoleValues.includes(role)) {
            storeGroup.style.display = 'none';
            document.getElementById('store-select').value = '';
        } else {
            storeGroup.style.display = '';
        }
    }
    document.getElementById('role-select').addEventListener('change', toggleStoreField);
    window.addEventListener('DOMContentLoaded', toggleStoreField);
</script>
{% endblock %}
