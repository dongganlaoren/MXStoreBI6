# **数据库结构文档 (V2.5)**

此文档描述了蜜雪冰城营业额上报模块所涉及的数据库表结构。

## 一、总览

数据库包含以下几张表：

*   `users`: 存储用户信息
*   `stores`: 存储店铺信息
*   `store_staff`: 存储店铺员工信息，关联用户和店铺
*   `daily_sales`: 存储每日营业额数据
*   `daily_sales_attachments`: 存储营业额上报附件信息

## 二、表结构详细说明

### 1. `users` 表 (总计 8 个字段)

| 序号 | 字段名            | 类型        | 是否必填 | 默认值              | 说明                                                         |
| ---- | ----------------- | ----------- | -------- | ------------------- | ------------------------------------------------------------ |
| 1    | user\_id          | Integer     | 是       | 自增                | 用户主键，自增 ID                                            |
| 2    | username          | String(64)  | 是       | 无                  | 登录用户名                                                   |
| 3    | password\_hash    | String(255) | 是       | 无                  | 登录密码哈希                                                 |
| 4    | user\_status      | Integer     | 是       | 1                   | 用户状态（1=活跃，0=禁用）                                   |
| 5    | last\_login\_time | DateTime    | 否       | NULL                | 最近一次登录时间                                             |
| 6    | created\_at       | DateTime    | 否       | 当前时间            | 创建时间                                                     |
| 7    | updated\_at       | DateTime    | 否       | 当前时间            | 更新时间                                                     |
| 8    | role              | Enum        | 否       | `RoleType.EMPLOYEE` | 用户角色 (admin, head\_manager, finance, branch\_manager, employee) |

### 2. `stores` 表 (总计 4 个字段)

| 序号 | 字段名                 | 类型        | 是否必填 | 默认值  | 说明                   |
| ---- | ---------------------- | ----------- | -------- | ------- | ---------------------- |
| 1    | store\_id              | String(32)  | 是       | 无      | 店铺唯一标识符         |
| 2    | store\_name            | String(100) | 是       | 无      | 店铺名称               |
| 3    | store\_address         | String(255) | 否       | 无      | 店铺地图地址链接       |
| 4    | third\_party\_platform | Boolean     | 否       | `False` | 是否开启第三方外卖平台 |

### 3. `store_staff` 表 (总计 13个字段)

| 序号 | 字段名                | 类型        | 是否必填 | 默认值   | 说明                                     |
| ---- | --------------------- | ----------- | -------- | -------- | ---------------------------------------- |
| 1    | staff\_id             | Integer     | 是       | 自增     | 员工主键                                 |
| 2    | store\_id             | String(32)  | 是       | 无       | 所属店铺 ID (外键关联 `stores.store_id`) |
| 3    | user\_id              | Integer     | 是       | 无       | 关联用户 ID (外键关联 `users.user_id`)   |
| 4    | bank\_account\_name   | String(64)  | 是       | 无       | 开户行名称                               |
| 5    | bank\_account\_number | String(64)  | 是       | 无       | 银行卡号                                 |
| 6    | staff\_position       | String(50)  | 是       | 无       | 职位                                     |
| 7    | is\_primary\_contact  | Boolean     | 否       | `False`  | 是否主联系人                             |
| 8    | phone                 | String(32)  | 否       | 无       | 电话                                     |
| 9    | line\_id              | String(64)  | 否       | 无       | Line账号                                 |
| 10   | email                 | String(100) | 否       | 无       | 邮箱地址                                 |
| 11   | start\_date           | Date        | 是       | 无       | 入职日期                                 |
| 12   | end\_date             | Date        | 否       | NULL     | 离职日期                                 |
| 13   | created\_at           | DateTime    | 否       | 当前时间 | 创建时间                                 |

### 4. `daily_sales` 表 (总计 21 个字段)

| 序号 | 字段名                    | 类型          | 是否必填 | 默认值      | 说明                                           |
| ---- | ------------------------- | ------------- | -------- | ----------- | ---------------------------------------------- |
| 1    | report\_id                | Integer       | 是       | 自增        | 唯一标识                                       |
| 2    | store\_id                 | String(32)    | 是       | 无          | 关联 `stores` 表                               |
| 3    | report\_date              | Date          | 是       | 无          | 上报的日期                                     |
| 4    | total\_income             | Numeric(18,2) | 否       | 0           | POS机小票总收入(T)                             |
| 5    | cash\_sales               | Numeric(18,2) | 否       | 0           | 现金收入（C）                                  |
| 6    | electronic\_sales         | Numeric(18,2) | 否       | 0           | 电子支付收入（P）                              |
| 7    | system\_takeaway\_sales   | Numeric(18,2) | 否       | 0           | POS系统中记录的外卖收入（D）                   |
| 8    | takeaway\_platform\_sales | Numeric(18,2) | 否       | 0           | 第三方平台实际到账外卖收入（Q2）               |
| 9    | cash\_difference          | Numeric(18,2) | 否       | 0           | 现金误差（A）                                  |
| 10   | electronic\_difference    | Numeric(18,2) | 否       | 0           | 电子支付误差（B）                              |
| 11   | voucher\_amount           | Numeric(18,2) | 否       | 0           | 使用代金券金额（R）                            |
| 12   | bank\_fee                 | Numeric(18,2) | 否       | 0           | 银行手续费 (F)                                 |
| 13   | bank\_deposit             | Numeric(18,2) | 否       | 0           | 实际到账金额                                   |
| 14   | actual\_sales             | Numeric(18,2) | 否       | 0           | 店铺实际营业额                                 |
| 15   | report\_status            | Enum          | 否       | `DRAFT_POS` | 上报状态，参见 `ReportStatus` 枚举             |
| 16   | financial\_check\_status  | Enum          | 否       | `PENDING`   | 财务核对状态，参见 `FinancialCheckStatus` 枚举 |
| 17   | archived                  | Boolean       | 否       | `False`     | 是否已归档                                     |
| 18   | created\_by               | Integer       | 否       | NULL        | 创建人（User ID）                              |
| 19   | created\_at               | DateTime      | 否       | 当前时间    | 创建时间                                       |
| 20   | modified\_by              | Integer       | 否       | NULL        | 最后修改人                                     |
| 21   | modified\_at              | DateTime      | 否       | 当前时间    | 修改时间                                       |

### 5. `daily_sales_attachments` 表 (总计 5 个字段)

| 序号 | 字段名           | 类型        | 是否必填 | 默认值   | 说明                                  |
| ---- | ---------------- | ----------- | -------- | -------- | ------------------------------------- |
| 1    | attachment\_id   | Integer     | 是       | 自增     | 凭证ID                                |
| 2    | report\_id       | Integer     | 是       | 无       | 关联 `daily_sales` 表的 `report_id`   |
| 3    | file\_path       | String(255) | 是       | 无       | 文件路径                              |
| 4    | attachment\_type | Enum        | 是       | 无       | 附件类型，参见 `attachment_type` 枚举 |
| 5    | created\_at      | DateTime    | 否       | 当前时间 | 创建时间                              |

**请再次仔细检查这份文档，尤其是 `store_staff` 表中新增的 `created_at` 字段。** 确认没有问题后，我们就可以开始生成代码了。